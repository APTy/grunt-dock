#
# Dockerfile for nginx
#
# proxy_set_header Host $host; \
#  proxy_set_header X-Real-IP $remote_addr; \
#  proxy_set_header X-Forwarded-Host nginx; \


FROM    debian:latest

# Install nginx
RUN     export DEBIAN_FRONTEND=noninteractive && \
        apt-get update; apt-get upgrade && \
        apt-get install -y nginx && \
        apt-get clean; apt-get autoremove

RUN     echo "\
        upstream node { \
          server 127.0.0.1:8080; \
        } \
        server { \
          server_name  localhost; \
          index index.html; \
          location / { \
          	try_files $uri $uri/ /index.html; \
          } \
          location /node { \
            proxy_pass http://node; \
          } \
        } \
        " > /etc/nginx/sites-available/default

RUN     ln -sf /dev/stdout /var/log/nginx/access.log && \
        ln -sf /dev/stderr /var/log/nginx/error.log

RUN     nginx -t

EXPOSE  80 443

CMD     ["nginx", "-g", "daemon off;"]
